# 测试

## 第1次

客户端是 client-go ，1000 个机器人

```txt
==========================================
运行环境信息
==========================================
CPU: 2 核心, Intel(R) Xeon(R) Platinum 8163 CPU @ 2.50GHz
     频率: 2500 MHz
内存: 总计 3.6 GB, 可用 3.0 GB
==========================================
分析监控结果...

=== 性能测试结果汇总 ===


server-pinus_stat:
  CPU：平均 7.0%，峰值 22.9%，P99 22.9%
  内存：平均 106.6 MB，峰值 119.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 82.8 KB/s，发 124.3 KB/s
  上下文切换：平均 1016.9 次/s，峰值 1041.0 次/s


server-cs_stat:
  CPU：平均 20.8%，峰值 61.5%，P99 61.5%
  内存：平均 47.4 MB，峰值 53.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 101.1 KB/s，发 160.7 KB/s
  上下文切换：平均 438178.8 次/s，峰值 780322.0 次/s


server-skynet_stat:
  CPU：平均 18.0%，峰值 75.2%，P99 75.2%
  内存：平均 184.3 MB，峰值 191.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 91.3 KB/s，发 149.9 KB/s
  上下文切换：平均 95215.4 次/s，峰值 159916.0 次/s


server-go_stat:
  CPU：平均 6.4%，峰值 22.0%，P99 22.0%
  内存：平均 23.6 MB，峰值 27.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 111.2 KB/s，发 181.4 KB/s
  上下文切换：平均 31236.8 次/s，峰值 56693.0 次/s


server-cpp_stat:
  CPU：平均 9.8%，峰值 71.3%，P99 71.3%
  内存：平均 89.9 MB，峰值 99.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 113.4 KB/s，发 189.3 KB/s
  上下文切换：平均 22377.4 次/s，峰值 59244.0 次/s


=== 结论（自动推断） ===
CPU 利用率最低：server-go_stat（平均 6.4%）
内存占用最低：server-go_stat（平均 23.6 MB）
锁竞争最少（ctx 切换最低）：server-pinus_stat（平均 1016.9 次/s）

分析完毕。
```

## 第2次测试

优化 echo/server-cs，再次测试

可以看到即使其他项目没有修改，监控数据也会有波动:


```txt
==========================================
运行环境信息
==========================================
CPU: 2 核心, Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz
     频率: 2500 MHz
内存: 总计 3.6 GB, 可用 3.0 GB
==========================================
分析监控结果...

=== 性能测试结果汇总 ===


server-pinus_stat:
  CPU：平均 7.1%，峰值 20.2%，P99 20.2%
  内存：平均 110.0 MB，峰值 119.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 116.7 KB/s，发 152.9 KB/s
  上下文切换：平均 928.3 次/s，峰值 1006.0 次/s


server-cs_stat:
  CPU：平均 12.3%，峰值 35.1%，P99 35.1%
  内存：平均 45.9 MB，峰值 53.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 121.4 KB/s，发 171.3 KB/s
  上下文切换：平均 485789.5 次/s，峰值 877775.0 次/s


server-skynet_stat:
  CPU：平均 18.2%，峰值 67.5%，P99 67.5%
  内存：平均 195.4 MB，峰值 204.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 122.3 KB/s，发 175.7 KB/s
  上下文切换：平均 88072.1 次/s，峰值 154508.0 次/s


server-go_stat:
  CPU：平均 4.8%，峰值 11.4%，P99 11.4%
  内存：平均 22.7 MB，峰值 24.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 119.7 KB/s，发 173.2 KB/s
  上下文切换：平均 47804.3 次/s，峰值 85333.0 次/s


server-cpp_stat:
  CPU：平均 12.0%，峰值 84.0%，P99 84.0%
  内存：平均 117.5 MB，峰值 162.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 132.8 KB/s，发 196.3 KB/s
  上下文切换：平均 31173.5 次/s，峰值 115580.0 次/s


=== 结论（自动推断） ===
CPU 利用率最低：server-go_stat（平均 4.8%）
内存占用最低：server-go_stat（平均 22.7 MB）
锁竞争最少（ctx 切换最低）：server-pinus_stat（平均 928.3 次/s）

分析完毕。
```

## 第3次测试

简化 echo/server-cs 代码，去掉了 saea pool。并且增加线程数的监控指标

可以看到，server-cs 的性能只有非常微小的提升

```txt
==========================================
运行环境信息
==========================================
CPU: 2 核心, Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz
     频率: 2500 MHz
内存: 总计 3.6 GB, 可用 3.0 GB
==========================================
分析监控结果...

=== 性能测试结果汇总 ===


server-pinus_stat:
  CPU：平均 8.7%，峰值 49.1%，P99 49.1%
  内存：平均 105.3 MB，峰值 108.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 125.7 KB/s，发 160.6 KB/s
  上下文切换：平均 906.7 次/s，峰值 985.0 次/s
  线程数：平均 11.0，最小 11，最大 11


server-cs_stat:
  CPU：平均 11.7%，峰值 34.7%，P99 34.7%
  内存：平均 44.5 MB，峰值 52.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 123.5 KB/s，发 174.2 KB/s
  上下文切换：平均 427385.7 次/s，峰值 761061.0 次/s
  线程数：平均 16.9，最小 14，最大 18


server-skynet_stat:
  CPU：平均 19.4%，峰值 88.3%，P99 88.3%
  内存：平均 190.0 MB，峰值 201.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 125.7 KB/s，发 179.5 KB/s
  上下文切换：平均 86408.2 次/s，峰值 154535.0 次/s
  线程数：平均 6.0，最小 6，最大 6


server-go_stat:
  CPU：平均 4.9%，峰值 10.8%，P99 10.8%
  内存：平均 22.7 MB，峰值 24.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 120.4 KB/s，发 175.2 KB/s
  上下文切换：平均 52917.0 次/s，峰值 96218.0 次/s
  线程数：平均 9.0，最小 9，最大 9


server-cpp_stat:
  CPU：平均 10.5%，峰值 72.5%，P99 72.5%
  内存：平均 93.8 MB，峰值 124.0 MB
  磁盘：读 0.0 KB/s，写 0.0 KB/s
  网络：收 129.7 KB/s，发 194.0 KB/s
  上下文切换：平均 30463.3 次/s，峰值 105039.0 次/s
  线程数：平均 1779.9，最小 3，最大 2022


=== 结论（自动推断） ===
CPU 利用率最低：server-go_stat（平均 4.9%）
内存占用最低：server-go_stat（平均 22.7 MB）
锁竞争最少（ctx 切换最低）：server-pinus_stat（平均 906.7 次/s）
```